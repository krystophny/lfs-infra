# pkgmk configuration for LFS
# Maximum performance build settings

# Directories (use LFS variable if set, default to /var/tmp/ert)
LFS="${LFS:-${LFS_BUILD_DIR:-/var/tmp/ert}}"
PKGMK_SOURCE_DIR="${LFS}/sources"
PKGMK_PACKAGE_DIR="${LFS}/pkg"
PKGMK_WORK_DIR="${LFS}/build/$name"

# Auto-detect CPU cores
NPROC=$(nproc)

# Aggressive optimization flags
export CFLAGS="-O3 -march=native -mtune=native -pipe -fomit-frame-pointer"
export CFLAGS="$CFLAGS -flto=$NPROC -fuse-linker-plugin"
export CFLAGS="$CFLAGS -funroll-loops -fprefetch-loop-arrays"
export CFLAGS="$CFLAGS -ftree-vectorize -fvect-cost-model=dynamic"
export CFLAGS="$CFLAGS -floop-nest-optimize"

export CXXFLAGS="$CFLAGS"

export LDFLAGS="-Wl,-O2 -Wl,--as-needed -Wl,--sort-common"
export LDFLAGS="$LDFLAGS -flto=$NPROC -fuse-linker-plugin"

# Prefer fast linker
if command -v mold >/dev/null 2>&1; then
    export LDFLAGS="$LDFLAGS -fuse-ld=mold"
elif command -v ld.lld >/dev/null 2>&1; then
    export LDFLAGS="$LDFLAGS -fuse-ld=lld"
fi

export MAKEFLAGS="-j$NPROC"

# Package compression
PKGMK_COMPRESSION_MODE="xz"

# Download settings
PKGMK_DOWNLOAD="yes"
PKGMK_DOWNLOAD_PROG="curl"

# Keep work directory for debugging (set to "no" for production)
PKGMK_KEEP_WORK="no"

# Ignore footprint mismatches
PKGMK_IGNORE_FOOTPRINT="no"
PKGMK_IGNORE_NEW="no"

# Ignore md5sum mismatches (only for git builds)
PKGMK_IGNORE_MD5SUM="no"

# Check signature
PKGMK_CHECK_SIGNATURE="no"
