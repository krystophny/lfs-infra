# Kernel config fragment for VM testing with fast boot
# Merge with: scripts/kconfig/merge_config.sh .config vm-fast-boot.config

# =============================================================================
# Fast Boot Optimizations
# =============================================================================

# Disable unused subsystems
CONFIG_SOUND=n
CONFIG_PCMCIA=n
CONFIG_PCCARD=n
CONFIG_ISDN=n
CONFIG_HAMRADIO=n
CONFIG_INFINIBAND=n
CONFIG_STAGING=n

# Minimal initramfs (or none)
CONFIG_BLK_DEV_INITRD=n

# Fast console
CONFIG_VT=y
CONFIG_VT_CONSOLE=y
CONFIG_FRAMEBUFFER_CONSOLE=y
CONFIG_FRAMEBUFFER_CONSOLE_DETECT_PRIMARY=y

# Disable kernel debug for speed
CONFIG_DEBUG_KERNEL=n
CONFIG_DEBUG_INFO=n
CONFIG_PRINTK_TIME=n

# =============================================================================
# VirtIO Drivers (QEMU/KVM)
# =============================================================================

CONFIG_VIRTIO=y
CONFIG_VIRTIO_PCI=y
CONFIG_VIRTIO_BALLOON=y
CONFIG_VIRTIO_BLK=y
CONFIG_VIRTIO_NET=y
CONFIG_VIRTIO_CONSOLE=y
CONFIG_VIRTIO_INPUT=y

# VirtIO GPU
CONFIG_DRM=y
CONFIG_DRM_VIRTIO_GPU=y

# VirtIO filesystem (for host sharing)
CONFIG_VIRTIO_FS=y
CONFIG_FUSE_FS=y

# =============================================================================
# Essential Hardware Support
# =============================================================================

# Block devices
CONFIG_BLK_DEV=y
CONFIG_BLK_DEV_LOOP=y

# SCSI (for virtio-scsi)
CONFIG_SCSI=y
CONFIG_BLK_DEV_SD=y
CONFIG_SCSI_VIRTIO=y

# Network
CONFIG_NET=y
CONFIG_INET=y
CONFIG_NETDEVICES=y
CONFIG_NET_CORE=y

# =============================================================================
# Filesystems
# =============================================================================

CONFIG_EXT4_FS=y
CONFIG_TMPFS=y
CONFIG_PROC_FS=y
CONFIG_SYSFS=y
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y

# =============================================================================
# CPU Optimizations (native)
# =============================================================================

# Enable march=native equivalent
CONFIG_MNATIVE_INTEL=y
CONFIG_MNATIVE_AMD=y

# Or for generic x86-64-v3 (AVX2, etc)
# CONFIG_GENERIC_CPU=n
# CONFIG_MX86_64_V3=y

# Processor features
CONFIG_X86_TSC=y
CONFIG_X86_CMPXCHG64=y
CONFIG_X86_USE_PPRO_CHECKSUM=y

# =============================================================================
# Performance
# =============================================================================

# Preemption model (voluntary for better throughput)
CONFIG_PREEMPT_VOLUNTARY=y

# Timer frequency (lower = less overhead)
CONFIG_HZ_300=y

# Disable kernel debugging
CONFIG_SLUB_DEBUG=n
CONFIG_STACKPROTECTOR=n
