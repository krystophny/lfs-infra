# Kernel config for AMD Ryzen 9 5950X (Zen 3)
# Optimized for: gaming, low-latency audio, fast boot, NVMe, NVIDIA RTX 5060 Ti
# Based on: CachyOS, Clear Linux optimizations

# =============================================================================
# CPU: AMD Zen 3 Specific
# =============================================================================

# Zen 3 processor family
CONFIG_PROCESSOR_SELECT=y
CONFIG_CPU_SUP_AMD=y
CONFIG_X86_MCE_AMD=y
CONFIG_MICROCODE=y
CONFIG_MICROCODE_AMD=y

# AMD-specific features
CONFIG_X86_AMD_PLATFORM_DEVICE=y
CONFIG_AMD_NB=y
CONFIG_AMD_IOMMU=y
CONFIG_AMD_IOMMU_V2=m

# AMD P-State driver (better than acpi-cpufreq for Zen)
CONFIG_X86_AMD_PSTATE=y
CONFIG_X86_AMD_PSTATE_DEFAULT_MODE=3
# Boot with: amd_pstate=active

# =============================================================================
# PREEMPTION: Low Latency / Real-Time
# =============================================================================

# Full preemption (best for low-latency audio/gaming)
CONFIG_PREEMPT=y
CONFIG_PREEMPT_BUILD=y
CONFIG_PREEMPT_COUNT=y
CONFIG_PREEMPTION=y
CONFIG_PREEMPT_DYNAMIC=y

# High timer frequency for responsiveness
CONFIG_HZ_1000=y
CONFIG_HZ=1000

# Tickless (reduces overhead when idle)
CONFIG_NO_HZ_IDLE=y
CONFIG_NO_HZ_COMMON=y
CONFIG_NO_HZ=y

# RCU optimizations for low latency
CONFIG_RCU_NOCB_CPU=y
CONFIG_RCU_LAZY=y

# =============================================================================
# SCHEDULER: Performance
# =============================================================================

# EEVDF scheduler (default in 6.6+, good for gaming)
CONFIG_SCHED_CORE=y

# CPU isolation for dedicated workloads
CONFIG_CPU_ISOLATION=y

# Multicore scheduler improvements
CONFIG_SCHED_MC=y
CONFIG_SCHED_MC_PRIO=y

# =============================================================================
# MEMORY: Performance
# =============================================================================

# Transparent Huge Pages (better for large allocations)
CONFIG_TRANSPARENT_HUGEPAGE=y
CONFIG_TRANSPARENT_HUGEPAGE_ALWAYS=y

# MGLRU (Multi-Gen LRU) - better memory management
CONFIG_LRU_GEN=y
CONFIG_LRU_GEN_ENABLED=y

# Memory compaction
CONFIG_COMPACTION=y

# NUMA (not needed for single socket, but keep for compatibility)
CONFIG_NUMA=y
CONFIG_AMD_NUMA=y
CONFIG_X86_64_ACPI_NUMA=y

# No swap needed with 96GB RAM
CONFIG_SWAP=n

# =============================================================================
# I/O SCHEDULER: NVMe Optimized
# =============================================================================

# Multi-queue block layer (essential for NVMe)
CONFIG_BLK_MQ_PCI=y
CONFIG_BLK_MQ_VIRTIO=y

# mq-deadline is best for NVMe
CONFIG_MQ_IOSCHED_DEADLINE=y
CONFIG_MQ_IOSCHED_KYBER=y
CONFIG_IOSCHED_BFQ=y

# NVMe specific
CONFIG_BLK_DEV_NVME=y
CONFIG_NVME_CORE=y
CONFIG_NVME_MULTIPATH=y
CONFIG_NVME_HWMON=y

# =============================================================================
# SOFTWARE RAID (mdadm)
# =============================================================================

# MD (Multiple Device) RAID support
CONFIG_MD=y
CONFIG_BLK_DEV_MD=y
CONFIG_MD_AUTODETECT=y

# RAID levels (enable what you need)
CONFIG_MD_RAID0=m
CONFIG_MD_RAID1=m
CONFIG_MD_RAID10=m
CONFIG_MD_RAID456=m

# Async operations for RAID5/6
CONFIG_ASYNC_CORE=m
CONFIG_ASYNC_MEMCPY=m
CONFIG_ASYNC_XOR=m
CONFIG_ASYNC_PQ=m
CONFIG_ASYNC_RAID6_RECOV=m

# =============================================================================
# AUDIO: Low Latency
# =============================================================================

CONFIG_SOUND=y
CONFIG_SND=y
CONFIG_SND_TIMER=y
CONFIG_SND_PCM=y
CONFIG_SND_HRTIMER=y
CONFIG_SND_DYNAMIC_MINORS=y
CONFIG_SND_MAX_CARDS=32

# PCI sound
CONFIG_SND_PCI=y

# HD Audio (your AMD Starship + NVIDIA)
CONFIG_SND_HDA=y
CONFIG_SND_HDA_INTEL=y
CONFIG_SND_HDA_CODEC_REALTEK=y
CONFIG_SND_HDA_CODEC_HDMI=y
CONFIG_SND_HDA_PREALLOC_SIZE=2048

# USB audio (for interfaces)
CONFIG_SND_USB=y
CONFIG_SND_USB_AUDIO=y

# =============================================================================
# GPU: NVIDIA Support
# =============================================================================

# Disable nouveau (using proprietary driver)
CONFIG_DRM_NOUVEAU=n

# DRM core needed
CONFIG_DRM=y
CONFIG_DRM_KMS_HELPER=y
CONFIG_DRM_FBDEV_EMULATION=y

# Framebuffer for early boot
CONFIG_FB=y
CONFIG_FB_VESA=y
CONFIG_FB_EFI=y
CONFIG_FB_SIMPLE=y

# PCI/PCIe
CONFIG_PCI=y
CONFIG_PCIEPORTBUS=y
CONFIG_PCIEASPM=y
CONFIG_PCIEASPM_PERFORMANCE=y
CONFIG_PCIE_BUS_PERFORMANCE=y

# =============================================================================
# NETWORKING: Fast
# =============================================================================

# TCP performance
CONFIG_TCP_CONG_BBR=y
CONFIG_DEFAULT_BBR=y
CONFIG_NET_SCH_FQ_CODEL=y

# Ethernet (Realtek likely on motherboard)
CONFIG_NETDEVICES=y
CONFIG_ETHERNET=y
CONFIG_R8169=y

# =============================================================================
# FAST BOOT
# =============================================================================

# Parallel init
CONFIG_PRINTK=y

# Quick boot options
CONFIG_BOOT_CONFIG=y
CONFIG_FAST_SYSCALL=y

# EFI
CONFIG_EFI=y
CONFIG_EFI_STUB=y
CONFIG_EFI_BOOTLOADER_CONTROL=y

# Initramfs
CONFIG_BLK_DEV_INITRD=y
CONFIG_INITRAMFS_COMPRESSION_ZSTD=y

# =============================================================================
# DISABLE UNNECESSARY (faster boot, smaller kernel)
# =============================================================================

# Debug off for performance
CONFIG_DEBUG_INFO=n
CONFIG_DEBUG_KERNEL=n
CONFIG_KPROBES=n

# Virtualization off (not needed for bare metal gaming)
CONFIG_VIRTUALIZATION=n
CONFIG_KVM=n

# Unused architectures
CONFIG_CPU_SUP_INTEL=n
CONFIG_CPU_SUP_CENTAUR=n
CONFIG_CPU_SUP_ZHAOXIN=n

# =============================================================================
# POWER: Performance Mode
# =============================================================================

# Keep power management for when needed
CONFIG_PM=y
CONFIG_ACPI=y
CONFIG_ACPI_CPPC_LIB=y

# But default to performance
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_DEFAULT_GOV_PERFORMANCE=y
CONFIG_CPU_FREQ_GOV_PERFORMANCE=y
CONFIG_CPU_FREQ_GOV_POWERSAVE=y
CONFIG_CPU_FREQ_GOV_SCHEDUTIL=y

# =============================================================================
# GAMING SPECIFIC
# =============================================================================

# Futex2 (for Wine/Proton)
CONFIG_FUTEX=y
CONFIG_FUTEX2=y

# eventfd (for game compatibility)
CONFIG_EVENTFD=y

# memfd (for shared memory)
CONFIG_MEMFD_CREATE=y

# userfaultfd (for CRIU, some games)
CONFIG_USERFAULTFD=y

# io_uring (modern async I/O)
CONFIG_IO_URING=y
